<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>语言学 on 大邓和他的PYTHON</title>
    <link>/tags/%E8%AF%AD%E8%A8%80%E5%AD%A6/</link>
    <description>Recent content in 语言学 on 大邓和他的PYTHON</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh</language>
    <lastBuildDate>Mon, 13 Mar 2023 00:00:00 +0000</lastBuildDate><atom:link href="/tags/%E8%AF%AD%E8%A8%80%E5%AD%A6/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>PNAS | 历史文本中的语言积极性反映了动态的环境和心理因素(含Python代码)</title>
      <link>https://hidadeng.github.io/blog/2023-03-13-linguistic-positivity-in-historical-texts-reflects-dynamic-environmental-and-psychological-factors/</link>
      <pubDate>Mon, 13 Mar 2023 00:00:00 +0000</pubDate>
      
      <guid>/blog/2023-03-13-linguistic-positivity-in-historical-texts-reflects-dynamic-environmental-and-psychological-factors/</guid>
      <description>Linguistic positivity in historical texts reflects dynamic environmental and psychological factors历史文本中的语言积极性反映了动态的环境和心理因素</description>
      <content:encoded><![CDATA[<p>分享一篇研究语言积极倾向的论文，论文中使用Python工具进行词频统计，大大降低了人工成本，提高了科研效率。</p>
<p>该论文发表在PNAS：</p>
<blockquote>
<p>Iliev, R., Hoover, J., Dehghani, M. and Axelrod, R., 2016. <strong>Linguistic positivity in historical texts reflects dynamic environmental and psychological factors</strong>. <em>Proceedings of the National Academy of Sciences</em>, <em>113</em>(49), pp.E7871-E7879.</p>
</blockquote>
<p><br><br></p>
<h2 id="一研究背景">一、研究背景</h2>
<p>作者指出：当前关于 <strong>LPB(language positivity bias)作用机制</strong> 的驱动因素有普遍的普遍的认知偏差、情感状态、客观环境和社会规范，但是究竟是哪种机制驱动LPB，以及这种影响是否可能是由于这些或其他因素子集之间的相互作用驱动的，尚无研究讨论。造成这种不确定性的一个原因是，以前对 LPB 的调查采用了语言的共时方法，并且无法提供任何洞察力来了解 LPB 在给定语言中是否或在何种程度上具有跨时间和上下文的稳定。在该研究中，作者采用了一种将 LPB 视为动态现象的方法。具体来说，使用两个带时间戳的美国英语语料库，研究 LPB 中的经度变化作为主观、客观和社会因素的函数。这种方法可以研究 LPB 的历时变化，这是一个未探索的影响维度，而且还可以在先前提出的 LPB 解释之间进行裁决。</p>
<p><br><br></p>
<h2 id="二研究过程">二、研究过程</h2>
<p>提出五个假设：</p>
<ol>
<li>
<p>LPB没有线性趋势</p>
</li>
<li>
<p>LPB 随着时间的推移而增加。</p>
</li>
<li>
<p>LPB 随着时间的推移而减少。</p>
</li>
<li>
<p>LPB 的变化来预测，环境恶化将与LPB的降低相关联。</p>
</li>
<li>
<p>LPB的变化将通过集体影响的变化来预测，因此国家层面幸福感的下降将与LPB的下降相关。</p>
</li>
</ol>
<p>开展四个研究：</p>
<ol>
<li>
<p>线性趋势</p>
</li>
<li>
<p>战争伤亡人数</p>
</li>
<li>
<p>经济苦难</p>
</li>
<li>
<p>主观幸福</p>
</li>
</ol>
<p><br><br></p>
<h2 id="三数据来源">三、数据来源</h2>
<ol>
<li><strong>情感词典</strong>：使用了语言查询和字数统计 (LIWC) 词典 (56) 中的正面和负面情绪词类别，其中包含 907 个词和词干。正面类别有 408 个条目，负面类别有 499 个条目。</li>
<li><strong>战争伤亡人数</strong>：使用了来自美国退伍军人事务部 (57) 的情况说明书中的数据，并计算了过去两个世纪美国参与的战争中美国军人的平均伤亡人数。</li>
<li><strong>痛苦指数</strong>：使用了来自 <a href="http://www.miseryindex.us">www.miseryindex.us</a> 的数据，其中包含 1948 年至 2015 年期间美国的苦难指数指标。</li>
<li><strong>幸福指数</strong>：使用了世界幸福数据库中有关美国幸福感的调查数据。</li>
</ol>
<p><br><br></p>
<h2 id="四研究发现">四、研究发现：</h2>
<ol>
<li>美式英语中情感词的使用随着时间的推移而减少。</li>
<li>发现了 LPB 纵向下降趋势的令人信服的证据。这种趋势在谷歌 Ngrams 语料库中非常强烈，在纽约时报语料库中略显重要。</li>
<li>发现 LPB 也随着战争的伤亡人数而减少。</li>
<li>LPB 可以通过客观环境的不太极端的测量来预测。在控制时间后，我们发现痛苦指数较高的年份在两个语料库中的 LPB 水平往往较低。</li>
<li>发现 LPB 的短期波动随全国幸福指数的变化而变化。</li>
<li>这些结果进一步证实了LPB 不能简单地解释为普遍认知机制的功能。</li>
</ol>
<p><br><br></p>
<h2 id="五代码">五、代码</h2>
<p>为简化学习难度，论文细节部分不展开。本文主要给大家展示用Python做情感词频统计、词频历时折线图这两部分内容。先安装需要的包</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">
!pip3 install pyecharts==1.6.2
!pip3 install pyecharts-javascripthon==0.0.6              
!pip3 install pyecharts-jupyter-installer==0.0.3              
!pip3 install pyecharts-snapshot==0.2.0 
</code></pre></div><br>
<h3 id="51-实验数据集">5.1 实验数据集</h3>
<p>美国政治在其年轻的生命周期中经历了许多意识形态的动荡。这些动荡被称为政治时代。“政治时代是指在历史和政治科学中使用的一种美国政治模式，用于分类存在于美国的政党制度。” 数据集作者创建这个数据集的原因是为了正确讨论过去的政治事件，了解各个时期的政治平台和氛围是很重要的。例如，民主党和共和党的政治理念在不同的时期发生了巨大的变化，党派之间的理念也在不断转变、涌现和消失。截至目前为止，美国政治中已经公认了6个政治时代，分别是：</p>
<ol>
<li>第一党派制度（1792年至1824年）</li>
<li>第二党派制度（1828年至1854年）</li>
<li>第三党派制度（1854年至1895年）</li>
<li>第四党派制度（1896年至1932年）</li>
<li>第五党派制度（1932年至1964年）</li>
<li>第六党派制度（1964年至今）</li>
</ol>
<p>我将总统同一个年度的演讲汇总到一起，最终得到  <a href="yearly_american_speech_dataset.csv">yearly_american_speech_dataset.csv</a> 。
<br></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;yearly_american_speech_dataset.csv&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
<span class="n">df</span>
</code></pre></div><p><img loading="lazy" src="img/df1.png" alt=""  />
</p>
<br>
<h3 id="52-小实验">5.2 小实验</h3>
<p>写代码讲究先把任务抽象化， 将大问题拆解成可组装的小问题。即先小后大，先局部后整体。这里推荐用Python中的cntext库，该库文档清晰，代码简洁。先安装</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">!pip3 install scikit-learn==1.0
!pip3 install cntext==1.8.4
</code></pre></div><br>
<p>最简单的情感分析，即分析一句话 text 的正负面情感词出现的词频。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">cntext</span> <span class="k">as</span> <span class="nn">ct</span>

<span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;What a sunny day!&#39;</span>

<span class="n">diction</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;sunny&#39;</span><span class="p">,</span> <span class="s1">&#39;good&#39;</span><span class="p">],</span>
           <span class="s1">&#39;neg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;bad&#39;</span><span class="p">,</span> <span class="s1">&#39;terrible&#39;</span><span class="p">]}</span>

<span class="n">ct</span><span class="o">.</span><span class="n">sentiment</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
             <span class="n">diction</span><span class="o">=</span><span class="n">diction</span><span class="p">,</span>
             <span class="n">lang</span><span class="o">=</span><span class="s1">&#39;english&#39;</span><span class="p">)</span>
</code></pre></div><p>Run</p>
<pre><code>{'pos_num': 1,
 'neg_num': 0,
 'stopword_num': 1,
 'word_num': 5,
 'sentence_num': 1}
</code></pre>
<br>
<p>根据自定义的词典diciton， 可以看出 <strong>What a sunny day!</strong> 中有1个pos类词，0个neg类词。</p>
<br>
<h3 id="53-找个公开的情感词典">5.3 找个公开的情感词典</h3>
<p>计算文本中正负面情感词出现次数， 需要有情感词词表。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">#查看cntext内置的词典</span>
<span class="kn">import</span> <span class="nn">cntext</span> <span class="k">as</span> <span class="nn">ct</span>

<span class="n">ct</span><span class="o">.</span><span class="n">dict_pkl_list</span><span class="p">()</span>
</code></pre></div><pre><code>['DUTIR.pkl',
 'HOWNET.pkl',
 'Chinese_Loughran_McDonald_Financial_Sentiment.pkl',
 'sentiws.pkl',
 'ChineseFinancialFormalUnformalSentiment.pkl',
 'Chinese_Digitalization.pkl',
 'ANEW.pkl',
 'LSD2015.pkl',
 'NRC.pkl',
 'geninqposneg.pkl',
 'HuLiu.pkl',
 'Loughran_McDonald_Financial_Sentiment.pkl',
 'AFINN.pkl',
 'ADV_CONJ.pkl',
 'STOPWORDS.pkl',
 'Concreteness.pkl',
 'ChineseEmoBank.pkl']
</code></pre>
<p>查看NRC词典的信息</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="c1">#NRC词典</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NRC词典描述: &#39;</span><span class="p">,</span> <span class="n">ct</span><span class="o">.</span><span class="n">load_pkl_dict</span><span class="p">(</span><span class="s1">&#39;NRC.pkl&#39;</span><span class="p">)[</span><span class="s1">&#39;Desc&#39;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NRC参考文献: &#39;</span><span class="p">,</span> <span class="n">ct</span><span class="o">.</span><span class="n">load_pkl_dict</span><span class="p">(</span><span class="s1">&#39;NRC.pkl&#39;</span><span class="p">)[</span><span class="s1">&#39;Refer&#39;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NRC词典内词表有: &#39;</span><span class="p">,</span> <span class="n">ct</span><span class="o">.</span><span class="n">load_pkl_dict</span><span class="p">(</span><span class="s1">&#39;NRC.pkl&#39;</span><span class="p">)[</span><span class="s1">&#39;NRC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pos词表前10个词: &#39;</span><span class="p">,</span> <span class="n">ct</span><span class="o">.</span><span class="n">load_pkl_dict</span><span class="p">(</span><span class="s1">&#39;NRC.pkl&#39;</span><span class="p">)[</span><span class="s1">&#39;NRC&#39;</span><span class="p">][</span><span class="s1">&#39;positive&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Neg词表前10个词: &#39;</span><span class="p">,</span> <span class="n">ct</span><span class="o">.</span><span class="n">load_pkl_dict</span><span class="p">(</span><span class="s1">&#39;NRC.pkl&#39;</span><span class="p">)[</span><span class="s1">&#39;NRC&#39;</span><span class="p">][</span><span class="s1">&#39;negative&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div><pre><code>NRC词典描述:  The NRC Emotion Lexicon is a list of English words and their associations with eight basic emotions (anger, fear, anticipation, trust, surprise, sadness, joy, and disgust) and two sentiments (negative and positive). The annotations were manually done by crowdsourcing.

NRC参考文献:  Crowdsourcing a Word-Emotion Association Lexicon, Saif Mohammad and Peter Turney, Computational Intelligence, 29 (3), 436-465, 2013.

NRC词典内词表有:  dict_keys(['anger', 'anticipation', 'disgust', 'fear', 'joy', 'negative', 'positive', 'sadness', 'surprise', 'trust'])

Pos词表前10个词:  ['abba', 'ability', 'abovementioned', 'absolute', 'absolution', 'absorbed', 'abundance', 'abundant', 'academic', 'academy']

Neg词表前10个词:  ['abandon', 'abandoned', 'abandonment', 'abduction', 'aberrant', 'aberration', 'abhor', 'abhorrent', 'abject', 'abnormal']
</code></pre>
<br>
<h3 id="54-情感词频统计">5.4 情感词频统计</h3>
<p>使用cntext设计一个函数，将计算得到的文本词数/正(负)面词出现次数, 得到情感词在文中的占比，方便后续的可视化绘图。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">emotion_analysis</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="n">diction</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pos&#39;</span><span class="p">:</span> <span class="n">ct</span><span class="o">.</span><span class="n">load_pkl_dict</span><span class="p">(</span><span class="s1">&#39;NRC.pkl&#39;</span><span class="p">)[</span><span class="s1">&#39;NRC&#39;</span><span class="p">][</span><span class="s1">&#39;positive&#39;</span><span class="p">],</span>
               <span class="s1">&#39;neg&#39;</span><span class="p">:</span> <span class="n">ct</span><span class="o">.</span><span class="n">load_pkl_dict</span><span class="p">(</span><span class="s1">&#39;NRC.pkl&#39;</span><span class="p">)[</span><span class="s1">&#39;NRC&#39;</span><span class="p">][</span><span class="s1">&#39;negative&#39;</span><span class="p">],</span>
               <span class="s1">&#39;anger&#39;</span><span class="p">:</span> <span class="n">ct</span><span class="o">.</span><span class="n">load_pkl_dict</span><span class="p">(</span><span class="s1">&#39;NRC.pkl&#39;</span><span class="p">)[</span><span class="s1">&#39;NRC&#39;</span><span class="p">][</span><span class="s1">&#39;anger&#39;</span><span class="p">],</span>
               <span class="s1">&#39;anticipation&#39;</span><span class="p">:</span> <span class="n">ct</span><span class="o">.</span><span class="n">load_pkl_dict</span><span class="p">(</span><span class="s1">&#39;NRC.pkl&#39;</span><span class="p">)[</span><span class="s1">&#39;NRC&#39;</span><span class="p">][</span><span class="s1">&#39;anticipation&#39;</span><span class="p">],</span>
               <span class="s1">&#39;disgust&#39;</span><span class="p">:</span> <span class="n">ct</span><span class="o">.</span><span class="n">load_pkl_dict</span><span class="p">(</span><span class="s1">&#39;NRC.pkl&#39;</span><span class="p">)[</span><span class="s1">&#39;NRC&#39;</span><span class="p">][</span><span class="s1">&#39;disgust&#39;</span><span class="p">],</span>
               <span class="s1">&#39;fear&#39;</span><span class="p">:</span> <span class="n">ct</span><span class="o">.</span><span class="n">load_pkl_dict</span><span class="p">(</span><span class="s1">&#39;NRC.pkl&#39;</span><span class="p">)[</span><span class="s1">&#39;NRC&#39;</span><span class="p">][</span><span class="s1">&#39;fear&#39;</span><span class="p">],</span>
               <span class="s1">&#39;joy&#39;</span><span class="p">:</span> <span class="n">ct</span><span class="o">.</span><span class="n">load_pkl_dict</span><span class="p">(</span><span class="s1">&#39;NRC.pkl&#39;</span><span class="p">)[</span><span class="s1">&#39;NRC&#39;</span><span class="p">][</span><span class="s1">&#39;joy&#39;</span><span class="p">],</span>
               <span class="s1">&#39;sadness&#39;</span><span class="p">:</span> <span class="n">ct</span><span class="o">.</span><span class="n">load_pkl_dict</span><span class="p">(</span><span class="s1">&#39;NRC.pkl&#39;</span><span class="p">)[</span><span class="s1">&#39;NRC&#39;</span><span class="p">][</span><span class="s1">&#39;sadness&#39;</span><span class="p">],</span>
               <span class="s1">&#39;surprise&#39;</span><span class="p">:</span> <span class="n">ct</span><span class="o">.</span><span class="n">load_pkl_dict</span><span class="p">(</span><span class="s1">&#39;NRC.pkl&#39;</span><span class="p">)[</span><span class="s1">&#39;NRC&#39;</span><span class="p">][</span><span class="s1">&#39;surprise&#39;</span><span class="p">],</span>
               <span class="s1">&#39;trust&#39;</span><span class="p">:</span> <span class="n">ct</span><span class="o">.</span><span class="n">load_pkl_dict</span><span class="p">(</span><span class="s1">&#39;NRC.pkl&#39;</span><span class="p">)[</span><span class="s1">&#39;NRC&#39;</span><span class="p">][</span><span class="s1">&#39;trust&#39;</span><span class="p">]}</span>
    
    <span class="n">res</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">sentiment</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                       <span class="n">diction</span><span class="o">=</span><span class="n">diction</span><span class="p">,</span>
                       <span class="n">lang</span><span class="o">=</span><span class="s1">&#39;english&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>


<span class="c1">#实验ok</span>
<span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;What a sunny day!&#39;</span>
<span class="n">emotion_analysis</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>
</code></pre></div><p>Run</p>
<pre><code>pos_num             1
neg_num             0
anger_num           0
anticipation_num    1
disgust_num         0
fear_num            0
joy_num             1
sadness_num         0
surprise_num        1
trust_num           0
stopword_num        1
word_num            5
sentence_num        1
dtype: int64
</code></pre>
<br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Transcript&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">emotion_analysis</span><span class="p">)</span>
<span class="n">df2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div><p><img loading="lazy" src="img/df2.png" alt=""  />
<br></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">df2</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div><p>Run</p>
<pre><code>Index(['pos_num', 'neg_num', 'anger_num', 'anticipation_num', 'disgust_num',
       'fear_num', 'joy_num', 'sadness_num', 'surprise_num', 'trust_num',
       'stopword_num', 'word_num', 'sentence_num'],
      dtype='object')
</code></pre>
<br>
<p>计算情感、情绪的词频(占比)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;pos_num&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">grouped_df2</span><span class="p">[</span><span class="s1">&#39;word_num&#39;</span><span class="p">]</span>
<span class="n">df2</span><span class="p">[</span><span class="s1">&#39;neg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;neg_num&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;word_num&#39;</span><span class="p">]</span>
<span class="n">df2</span><span class="p">[</span><span class="s1">&#39;anger&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;anger_num&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;word_num&#39;</span><span class="p">]</span>
<span class="n">df2</span><span class="p">[</span><span class="s1">&#39;anticipation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;anticipation_num&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;word_num&#39;</span><span class="p">]</span>
<span class="n">df2</span><span class="p">[</span><span class="s1">&#39;disgust&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;disgust_num&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;word_num&#39;</span><span class="p">]</span>
<span class="n">df2</span><span class="p">[</span><span class="s1">&#39;fear&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;fear_num&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;word_num&#39;</span><span class="p">]</span>
<span class="n">df2</span><span class="p">[</span><span class="s1">&#39;joy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;joy_num&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;word_num&#39;</span><span class="p">]</span>
<span class="n">df2</span><span class="p">[</span><span class="s1">&#39;sadness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;sadness_num&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;word_num&#39;</span><span class="p">]</span>
<span class="n">df2</span><span class="p">[</span><span class="s1">&#39;surprise&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;surprise_num&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;word_num&#39;</span><span class="p">]</span>
<span class="n">df2</span><span class="p">[</span><span class="s1">&#39;trust&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;trust_num&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;word_num&#39;</span><span class="p">]</span>
<span class="n">df2</span><span class="p">[</span><span class="s1">&#39;SentiScore&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;pos_num&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;neg_num&#39;</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;pos_num&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;neg_num&#39;</span><span class="p">])</span>
</code></pre></div><br>
<p>合并数据数据</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">res_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">res_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div><p><img loading="lazy" src="img/df3.png" alt=""  />
</p>
<p><br><br></p>
<h2 id="六可视化">六、可视化</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">res_df</span><span class="o">.</span><span class="n">columns</span>
</code></pre></div><p>Run</p>
<pre><code>Index(['pos_num', 'neg_num', 'anger_num', 'anticipation_num', 'disgust_num',
       'fear_num', 'joy_num', 'sadness_num', 'surprise_num', 'trust_num',
       'stopword_num', 'word_num', 'sentence_num', 'pos', 'neg', 'anger',
       'anticipation', 'disgust', 'fear', 'joy', 'sadness', 'surprise',
       'trust'],
      dtype='object')
</code></pre>
<br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pyecharts</span> <span class="kn">import</span> <span class="n">options</span> <span class="k">as</span> <span class="n">opts</span>
<span class="kn">from</span> <span class="nn">pyecharts.charts</span> <span class="kn">import</span> <span class="n">Line</span>
<span class="kn">from</span> <span class="nn">pyecharts.globals</span> <span class="kn">import</span> <span class="n">CurrentConfig</span><span class="p">,</span> <span class="n">NotebookType</span>
<span class="n">CurrentConfig</span><span class="o">.</span><span class="n">NOTEBOOK_TYPE</span> <span class="o">=</span> <span class="n">NotebookType</span><span class="o">.</span><span class="n">JUPYTER_NOTEBOOK</span>


<span class="c1"># 创建折线图对象</span>
<span class="n">line_chart1</span> <span class="o">=</span> <span class="n">Line</span><span class="p">()</span>


<span class="c1"># 添加 x 轴和 y 轴数据</span>
<span class="n">line_chart1</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
<span class="n">line_chart1</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s1">&#39;Sentiment Score&#39;</span><span class="p">,</span> 
                      <span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;SentiScore&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                     <span class="n">itemstyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">ItemStyleOpts</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>


<span class="c1"># 配置图表选项</span>
<span class="n">line_chart1</span><span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
    <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&#34;美国总统演讲情感得分年度历时可视化&#34;</span><span class="p">),</span>
    <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&#34;axis&#34;</span><span class="p">,</span> <span class="n">axis_pointer_type</span><span class="o">=</span><span class="s2">&#34;cross&#34;</span><span class="p">),</span>
    <span class="n">legend_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LegendOpts</span><span class="p">(</span><span class="n">pos_right</span><span class="o">=</span><span class="s2">&#34;right&#34;</span><span class="p">,</span>
                                <span class="n">orient</span><span class="o">=</span><span class="s2">&#34;vertical&#34;</span><span class="p">,</span>
                                <span class="n">pos_top</span><span class="o">=</span><span class="s2">&#34;center&#34;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># 显示图表</span>
<span class="n">line_chart1</span><span class="o">.</span><span class="n">render_notebook</span><span class="p">()</span>
</code></pre></div><p><a href="line_chart1.html"><img loading="lazy" src="img/%e5%9b%be1.png" alt=""  />
</a></p>
<br>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pyecharts</span> <span class="kn">import</span> <span class="n">options</span> <span class="k">as</span> <span class="n">opts</span>
<span class="kn">from</span> <span class="nn">pyecharts.charts</span> <span class="kn">import</span> <span class="n">Line</span>
<span class="kn">from</span> <span class="nn">pyecharts.globals</span> <span class="kn">import</span> <span class="n">CurrentConfig</span><span class="p">,</span> <span class="n">NotebookType</span>
<span class="n">CurrentConfig</span><span class="o">.</span><span class="n">NOTEBOOK_TYPE</span> <span class="o">=</span> <span class="n">NotebookType</span><span class="o">.</span><span class="n">JUPYTER_NOTEBOOK</span>


<span class="c1"># 创建折线图对象</span>
<span class="n">line_chart2</span> <span class="o">=</span> <span class="n">Line</span><span class="p">()</span>


<span class="c1"># 添加 x 轴和 y 轴数据</span>
<span class="n">line_chart2</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

<span class="n">line_chart2</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s1">&#39;Positive&#39;</span><span class="p">,</span> 
                      <span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                      <span class="n">itemstyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">ItemStyleOpts</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">line_chart2</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s1">&#39;Negative&#39;</span><span class="p">,</span> 
                      <span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;neg&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                      <span class="n">itemstyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">ItemStyleOpts</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># 配置图表选项</span>
<span class="n">line_chart2</span><span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
    <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&#34;美国总统演讲正、负面情感年度历时可视化&#34;</span><span class="p">),</span>
    <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&#34;axis&#34;</span><span class="p">,</span> <span class="n">axis_pointer_type</span><span class="o">=</span><span class="s2">&#34;cross&#34;</span><span class="p">),</span>
    <span class="n">legend_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LegendOpts</span><span class="p">(</span><span class="n">pos_right</span><span class="o">=</span><span class="s2">&#34;right&#34;</span><span class="p">,</span>
                                <span class="n">orient</span><span class="o">=</span><span class="s2">&#34;vertical&#34;</span><span class="p">,</span>
                                <span class="n">pos_top</span><span class="o">=</span><span class="s2">&#34;center&#34;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># 显示图表</span>
<span class="n">line_chart2</span><span class="o">.</span><span class="n">render_notebook</span><span class="p">()</span>
</code></pre></div><p><a href="line_chart2.html"><img loading="lazy" src="img/%e5%9b%be2.png" alt=""  />
</a><br></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">pyecharts</span> <span class="kn">import</span> <span class="n">options</span> <span class="k">as</span> <span class="n">opts</span>
<span class="kn">from</span> <span class="nn">pyecharts.charts</span> <span class="kn">import</span> <span class="n">Line</span>
<span class="kn">from</span> <span class="nn">pyecharts.globals</span> <span class="kn">import</span> <span class="n">CurrentConfig</span><span class="p">,</span> <span class="n">NotebookType</span>
<span class="n">CurrentConfig</span><span class="o">.</span><span class="n">NOTEBOOK_TYPE</span> <span class="o">=</span> <span class="n">NotebookType</span><span class="o">.</span><span class="n">JUPYTER_NOTEBOOK</span>


<span class="c1"># 创建折线图对象</span>
<span class="n">line_chart3</span> <span class="o">=</span> <span class="n">Line</span><span class="p">()</span>

<span class="c1"># 添加 x 轴和 y 轴数据</span>
<span class="n">line_chart3</span><span class="o">.</span><span class="n">add_xaxis</span><span class="p">(</span><span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

<span class="n">line_chart3</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s1">&#39;anger&#39;</span><span class="p">,</span> 
                      <span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;anger&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                      <span class="n">itemstyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">ItemStyleOpts</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">line_chart3</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s1">&#39;anticipation&#39;</span><span class="p">,</span> 
                      <span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;anticipation&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                      <span class="n">itemstyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">ItemStyleOpts</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">line_chart3</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s1">&#39;disgust&#39;</span><span class="p">,</span> 
                      <span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;disgust&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                      <span class="n">itemstyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">ItemStyleOpts</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">line_chart3</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s1">&#39;fear&#39;</span><span class="p">,</span> 
                      <span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;fear&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                      <span class="n">itemstyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">ItemStyleOpts</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">line_chart3</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s1">&#39;joy&#39;</span><span class="p">,</span> 
                      <span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;joy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                      <span class="n">itemstyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">ItemStyleOpts</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">line_chart3</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s1">&#39;sadness&#39;</span><span class="p">,</span> 
                      <span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;sadness&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                      <span class="n">itemstyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">ItemStyleOpts</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">line_chart3</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s1">&#39;surprise&#39;</span><span class="p">,</span> 
                      <span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;surprise&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                      <span class="n">itemstyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">ItemStyleOpts</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">line_chart3</span><span class="o">.</span><span class="n">add_yaxis</span><span class="p">(</span><span class="s1">&#39;trust&#39;</span><span class="p">,</span> 
                      <span class="n">res_df</span><span class="p">[</span><span class="s1">&#39;trust&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                      <span class="n">itemstyle_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">ItemStyleOpts</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>


<span class="c1"># 配置图表选项</span>
<span class="n">line_chart3</span><span class="o">.</span><span class="n">set_global_opts</span><span class="p">(</span>
    <span class="n">title_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TitleOpts</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&#34;美国总统8类情绪词用量年度历时可视化&#34;</span><span class="p">),</span>
    <span class="n">tooltip_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">TooltipOpts</span><span class="p">(</span><span class="n">trigger</span><span class="o">=</span><span class="s2">&#34;axis&#34;</span><span class="p">,</span> <span class="n">axis_pointer_type</span><span class="o">=</span><span class="s2">&#34;cross&#34;</span><span class="p">),</span>
    <span class="n">legend_opts</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">LegendOpts</span><span class="p">(</span><span class="n">pos_right</span><span class="o">=</span><span class="s2">&#34;right&#34;</span><span class="p">,</span>
                                <span class="n">orient</span><span class="o">=</span><span class="s2">&#34;vertical&#34;</span><span class="p">,</span>
                                <span class="n">pos_top</span><span class="o">=</span><span class="s2">&#34;center&#34;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># 显示图表</span>
<span class="n">line_chart3</span><span class="o">.</span><span class="n">render_notebook</span><span class="p">()</span>
</code></pre></div><p><a href="line_chart3.html"><img loading="lazy" src="img/%e5%9b%be3.png" alt=""  />
</a>
<a href="line_chart3.html"><img loading="lazy" src="img/%e5%9b%be4.png" alt=""  />
</a></p>
<p>最后一张图中trust指标在08年前后几年是下降趋势，可能的原因是， 那个阶段正是08年金融危机，美国政府为了救华尔街， 用公民腰包里的钱补贴华尔街金融巨鳄。信任下降。</p>
<p><br><br></p>
<h2 id="七保存">七、保存</h2>
<p>情感计算过程得到的 res_df 和 可视化结果line_chart 建议都保存起来， 方便下次可以快速进入可视化阶段。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">res_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;sentiment_anlysis_result.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">line_chart1</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;line_chart1.html&#39;</span><span class="p">)</span>
<span class="n">line_chart2</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;line_chart2.html&#39;</span><span class="p">)</span>
<span class="n">line_chart3</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="s1">&#39;line_chart3.html&#39;</span><span class="p">)</span>
</code></pre></div><p><br><br></p>
<h2 id="资料下载">资料下载</h2>
<ul>
<li><a href="code.ipynb">代码</a></li>
<li><a href="yearly_american_speech_dataset.csv">数据</a></li>
</ul>
<p><br><br></p>
<h2 id="广而告之">广而告之</h2>
<ul>
<li><a href="https://textdata.cn/blog/call_for_paper/">长期征稿</a></li>
<li><a href="https://textdata.cn/blog/we_need_you/">长期招募小伙伴</a></li>
<li><a href="https://textdata.cn/blog/management_python_course/">付费视频课 | Python实证指标构建与文本分析</a></li>
</ul>
]]></content:encoded>
    </item>
    
  </channel>
</rss>

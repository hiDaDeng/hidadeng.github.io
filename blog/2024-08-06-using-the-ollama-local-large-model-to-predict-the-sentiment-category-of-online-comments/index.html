<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>实验 | 使用本地大模型预测在线评论情感类别 | 大邓和他的PYTHON</title>
<meta name="keywords" content="Python, large language model, 大语言模型, 情感分析, sentiment analysis, ollama" />
<meta name="description" content="情感分析是分析文本以确定消息的情绪基调是积极、消极还是中性的过程。通过情感分析，我们可以了解文本是否表现出快乐、悲伤、愤怒等情绪。主要的计算方法有语义词典法、机器学习法、混合方法、其他方法。 随着chatGPT这类大语言模型的出现， 它们增强了文本理解能力，使我们能够更精准的把握文本中的语义和情绪，也因此大型语言模型 (LLM) 一出场就有实现情感分析功能。Sentiment analysis is the process of analyzing text to determine whether the emotional tone of a message is positive, negative, or neutral. Through sentiment analysis, we can understand whether the text expresses emotions such as happiness, sadness, anger, etc. The main computational methods are semantic dictionary method, machine learning method, hybrid method, and other methods. With the emergence of large language models such as chatGPT, they enhance text understanding capabilities, allowing us to more accurately grasp the semantics and emotions in the text. Therefore, large language models (LLMs) have implemented sentiment analysis functions as soon as they appeared.">
<meta name="author" content="大邓">
<link rel="canonical" href="/blog/2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments/" />
<meta name="baidu-site-verification" content="codeva-TJUe6nOmGr" />
<meta name="360-site-verification" content="6b9b733ec558a1bb12cee8aa82f2529e" />
<meta name="sogou-site-verification" content="dZHPIorOhK" />
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.css" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.js" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.89.4" />
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="实验 | 使用本地大模型预测在线评论情感类别" />
<meta property="og:description" content="情感分析是分析文本以确定消息的情绪基调是积极、消极还是中性的过程。通过情感分析，我们可以了解文本是否表现出快乐、悲伤、愤怒等情绪。主要的计算方法有语义词典法、机器学习法、混合方法、其他方法。 随着chatGPT这类大语言模型的出现， 它们增强了文本理解能力，使我们能够更精准的把握文本中的语义和情绪，也因此大型语言模型 (LLM) 一出场就有实现情感分析功能。Sentiment analysis is the process of analyzing text to determine whether the emotional tone of a message is positive, negative, or neutral. Through sentiment analysis, we can understand whether the text expresses emotions such as happiness, sadness, anger, etc. The main computational methods are semantic dictionary method, machine learning method, hybrid method, and other methods. With the emergence of large language models such as chatGPT, they enhance text understanding capabilities, allowing us to more accurately grasp the semantics and emotions in the text. Therefore, large language models (LLMs) have implemented sentiment analysis functions as soon as they appeared." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/blog/2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments/" />
<meta property="og:image" content="/images/blog/sentiment-analysis-with-llms.jpeg" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2024-08-06T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2024-08-06T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="/images/blog/sentiment-analysis-with-llms.jpeg" />
<meta name="twitter:title" content="实验 | 使用本地大模型预测在线评论情感类别"/>
<meta name="twitter:description" content="情感分析是分析文本以确定消息的情绪基调是积极、消极还是中性的过程。通过情感分析，我们可以了解文本是否表现出快乐、悲伤、愤怒等情绪。主要的计算方法有语义词典法、机器学习法、混合方法、其他方法。 随着chatGPT这类大语言模型的出现， 它们增强了文本理解能力，使我们能够更精准的把握文本中的语义和情绪，也因此大型语言模型 (LLM) 一出场就有实现情感分析功能。Sentiment analysis is the process of analyzing text to determine whether the emotional tone of a message is positive, negative, or neutral. Through sentiment analysis, we can understand whether the text expresses emotions such as happiness, sadness, anger, etc. The main computational methods are semantic dictionary method, machine learning method, hybrid method, and other methods. With the emergence of large language models such as chatGPT, they enhance text understanding capabilities, allowing us to more accurately grasp the semantics and emotions in the text. Therefore, large language models (LLMs) have implemented sentiment analysis functions as soon as they appeared."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blogs",
      "item": "/blog/"
    }
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "实验 | 使用本地大模型预测在线评论情感类别",
      "item": "/blog/2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "实验 | 使用本地大模型预测在线评论情感类别",
  "name": "实验 | 使用本地大模型预测在线评论情感类别",
  "description": "情感分析是分析文本以确定消息的情绪基调是积极、消极还是中性的过程。通过情感分析，我们可以了解文本是否表现出快乐、悲伤、愤怒等情绪。主要的计算方法有语义词典法、机器学习法、混合方法、其他方法。 随着chatGPT这类大语言模型的出现， 它们增强了文本理解能力，使我们能够更精准的把握文本中的语义和情绪，也因此大型语言模型 (LLM) 一出场就有实现情感分析功能。Sentiment analysis is the process of analyzing text to determine whether the emotional tone of a message is positive, negative, or neutral. Through sentiment analysis, we can understand whether the text expresses emotions such as happiness, sadness, anger, etc. The main computational methods are semantic dictionary method, machine learning method, hybrid method, and other methods. With the emergence of large language models such as chatGPT, they enhance text understanding capabilities, allowing us to more accurately grasp the semantics and emotions in the text. Therefore, large language models (LLMs) have implemented sentiment analysis functions as soon as they appeared.",
  "keywords": [
    "Python", "large language model", "大语言模型", "情感分析", "sentiment analysis", "ollama"
  ],
  "articleBody": "情感分析是分析文本以确定消息的情绪基调是积极、消极还是中性的过程。通过情感分析，我们可以了解文本是否表现出快乐、悲伤、愤怒等情绪。主要的计算方法有语义词典法、机器学习法、混合方法、其他方法。 随着chatGPT这类大语言模型的出现， 它们增强了文本理解能力，使我们能够更精准的把握文本中的语义和情绪，也因此大型语言模型 (LLM) 一出场就有实现情感分析功能。\n一、任务描述 大邓准备了200条外卖评论数据(下图蓝色框)， 已进行标注, 其中负面110条，正面90条。\n现在想设计一个Prompt， 使用中文大模型对 review 文本进行情感类别(pos/neg)的预测(红色框)， 最终会计算大模型预测的准确率。\n先提前剧透一下， 模型预测的准确率89.5%。这种准确率，用到经管社科研究中， 应该没啥问题。\n\n二、传统模式 VS 大语言模型 大语言模型 (LLM) 因其在理解和生成人类语言方面的熟练程度而在情绪分析方面表现出色。通过对各种数据和算法进行训练，LLM 可以检测文本中的细微差别，从而增强其在社交媒体、新闻文章和客户评论等平台上掌握人们情绪和观点的能力。它们捕捉上下文和情感线索的能力提高了情绪分析的准确性和深度。\n情感分析领域，传统模式与大语言模型 (LLM) 的比较\n 传统的内容分析方法可能难以准确捕捉细微的情绪。 LLM 使用深度学习和迁移学习等先进技术，擅长理解不同的语言表达。 LLM 在跨文本源（包括社交媒体帖子和新闻文章）的情感分析方面具有卓越的准确性和效率。  \n三、Ollama Ollama是一款开源应用程序，可让您使用 MacOS、Linux 和 Windows 上的命令行界面在本地运行、创建和共享大型语言模型。\nOllama 可以直接从其库中访问各种 LLM，只需一个命令即可下载。下载后，只需执行一个命令即可开始使用。这对于工作量围绕终端窗口的用户非常有帮助。Ollama的安装、配置、使用的详细教程可阅读 教程 | 如何使用 Ollama 下载 \u0026 使用本地大语言模型\n3.1 安装模型 假设电脑中已安装了Ollama软件， 现在安装需要的大模型。 这里我们安装\n qwen2:7b： 阿里的通义千问大模型， 主要适用于中文场景， 英文也可。 llama3:8b：Meta发布的LLama大模型，主要适用于英文场景， 中文也可。  ollama pull qwen2:7b ollama pull llama3:8b \n3.2 安装python包 打开电脑命令行cmd(mac是terminal), 网络是连网状态，执行安装命令\npip3 install ollama \n3.3 启动ollama服务 在电脑中找到软件Ollama， 双击打开，即可开启Ollama服务。\n\n四、实验 4.1 代码结构 project - code.ipynb #代码 - data.csv #在线评论数据 - result.csv #预测结果 \n4.2 读取数据 data.csv 内存储着200条外卖评论，均已标注(1正面， 0负面)\nimport pandas as pd df = pd.read_csv('data.csv') df 字段的数据类型\ndf.dtypes Run\nlabel int64 review object dtype: object \nlabel数值的分布\ndf.label.value_counts() Run\nlabel 0 110 1 90 Name: count, dtype: int64 \n4.3 设计提示 需要根据单词，生成单词、音标、语义、例句、历史文化、相关单词等信息， 提示如下，\nPROMPT = \"\"\" 您的任务是分析淘宝店铺中买家评论的情感类型(neg、pos)。  {{COMMENT_CONTENT}}  请根据以下准则分析此评论的情感： \"neg\"：评论文本中包含强烈的负面情绪、沮丧或不满。 \"pos\"：评论文本表达了满意、感激或积极情绪 分析后，请以以下 JSON 格式提供最终结果：  { \"sentiment\": \"[neg/pos]\", }  \"\"\" \n4.4 小实验 %%time import ollama COMMENT_CONTENT = \"11点14订餐，13点20饭才到，2个小时才把我的午饭送到，而且还是打了2次客服电话，1次投诉电话才给送来，要是不打电话都不知道几点能吃上午饭？\" response = ollama.chat(model='qwen2:7b', messages=[ {'role': 'system', 'content': PROMPT}, {'role': 'user', 'content': COMMENT_CONTENT}, ]) result = response['message']['content'] print(result) Run\n { \"sentiment\": \"neg\" }  CPU times: user 3.85 ms, sys: 2.5 ms, total: 6.35 ms Wall time: 1.42 s 运行一条评论耗时1.42s， 需要注意，返回结果的格式不唯一也不确定，这是我发现的别的格式\n{ \"sentiment\": \"neg\" } CPU times: user 1.94 ms, sys: 1.33 ms, total: 3.27 ms Wall time: 329 ms \n据此，设计了如下的代码\nif 'pos' in result: senti = 'pos' elif 'neg' in result: senti = 'neg' else: senti = 'NA' print(senti) Run\nneg \n五、 批量运算 %%time import pandas as pd import ollama from tqdm import tqdm PROMPT = \"\"\" 您的任务是分析淘宝店铺中买家评论的情绪和类型。您的目标是确定评论情感(neg、pos)。  {{COMMENT_CONTENT}}  请根据以下准则分析此评论的情感： \"neg\"：评论文本中包含强烈的负面情绪、沮丧或不满。 \"pos\"：评论文本表达了满意、感激或积极情绪 分析后，请以以下 JSON 格式提供最终结果：  { \"sentiment\": \"[neg/pos]\", }  \"\"\" #考虑到大模型回答的随机性，很容易报错。 #使用tryexcept增强代码的鲁棒性 def sentiment_analysis(comment_text): try: response = ollama.chat(model = 'qwen2:7b', messages = [ {'role': 'system', 'content': PROMPT}, {'role': 'user', 'content': comment_text} ]) result = response['message']['content'] if 'pos' in result: senti = 'pos' elif 'neg' in result: senti = 'neg' else: senti = 'NA' return senti except: return 'NA' sentis = [] #读取数据 df = pd.read_csv('data.csv') for review in tqdm(df['review']): senti = sentiment_analysis(review) sentis.append(senti) df['sentiment'] = sentis #保存结果 df.to_csv('result.csv', index=False) df 六、检查准确率 假设label为1时， sentiment为pos(或label为0时， sentiment为neg)， 大模型判断正确。反之，判断失误。\nexpression = \"(label == 1) \u0026 (sentiment == 'pos') | (label == 0) \u0026 (sentiment == 'neg')\" correct_ratio = len(df.query(expression))/ len(df) print(f'准确率: {correct_ratio*100}%') Run\n准确率: 89.5% 今天使用的国产大模型（qwen2:8b) 预测情感分类的表现还不错， 准确率高达89.5% 。这种准确率，用到经管社科研究中， 应该没啥问题。\n精选内容  LIST | 可供社科(经管)领域使用的数据集汇总 LIST | 社科(经管)数据挖掘文献资料汇总 网络爬虫 | 使用scrapegraph-ai(大模型方案)自动采集网页数据 推荐 | 文本分析库cntext2.x使用手册 付费视频课 | Python实证指标构建与文本分析 实验 | 使用本地大模型从文本中提取结构化信息  ",
  "wordCount" : "395",
  "inLanguage": "en",
  "image":"/images/blog/sentiment-analysis-with-llms.jpeg","datePublished": "2024-08-06T00:00:00Z",
  "dateModified": "2024-08-06T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "大邓"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/blog/2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "大邓和他的PYTHON",
    "logo": {
      "@type": "ImageObject",
      "url": "/favicon.ico"
    }
  }
}
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SFGQCREQ9X"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SFGQCREQ9X');
</script>



<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=PT+Serif" rel="stylesheet">
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/" accesskey="h" title="大邓和他的PYTHON (Alt + H)" target="_blank">大邓和他的PYTHON</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="/about/" title="关于" target="_blank">
                    <span>关于</span>
                </a>
            </li>
            <li>
                <a href="/blog" title="博文" target="_blank">
                    <span>博文</span>
                </a>
            </li>
            <li>
                <a href="/search/" title="搜索" target="_blank">
                    <span>搜索</span>
                </a>
            </li>
            <li>
                <a href="/tags/" title="标签" target="_blank">
                    <span>标签</span>
                </a>
            </li>
            <li>
                <a href="/blog/management_python_course/" title="课程" target="_blank">
                    <span>课程</span>
                </a>
            </li>
            <li>
                <a href="/blog/the_text_analysis_list_about_ms/" title="文献" target="_blank">
                    <span>文献</span>
                </a>
            </li>
            <li>
                <a href="/blog/datasets_available_for_management_science/" title="数据" target="_blank">
                    <span>数据</span>
                </a>
            </li>
            <li>
                <a href="/blog/2024-04-27-cntext2x-usage-tutorial/" title="cntext2.x" target="_blank">
                    <span>cntext2.x</span>
                </a>
            </li>
            <li>
                <a href="/index.xml" title="RSS" target="_blank">
                    <span>RSS</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous"
onload="renderMathInElement(document.body);"></script>




<article class="post-single">
  <header class="post-header">
    
    <div class="breadcrumbs"><a href="/" target="_blank">Home</a>&nbsp;»&nbsp;<a href="/blog/" target="_blank">Blogs</a></div>
    <h1 class="post-title">
      实验 | 使用本地大模型预测在线评论情感类别
    </h1>
    <div class="post-meta"><span title='2024-08-06 00:00:00 +0000 UTC'>2024-08-06</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;大邓

</div>
  </header> 
<figure class="entry-cover"><a href="/images/blog/sentiment-analysis-with-llms.jpeg" target="_blank"
            rel="noopener noreferrer"><img loading="lazy" src="/images/blog/sentiment-analysis-with-llms.jpeg" alt=""></a>
        
</figure>
<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share 实验 | 使用本地大模型预测在线评论情感类别 on twitter"
        href="https://twitter.com/intent/tweet/?text=%e5%ae%9e%e9%aa%8c%20%7c%20%e4%bd%bf%e7%94%a8%e6%9c%ac%e5%9c%b0%e5%a4%a7%e6%a8%a1%e5%9e%8b%e9%a2%84%e6%b5%8b%e5%9c%a8%e7%ba%bf%e8%af%84%e8%ae%ba%e6%83%85%e6%84%9f%e7%b1%bb%e5%88%ab&amp;url=%2fblog%2f2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments%2f&amp;hashtags=LLM%2c%e6%96%87%e6%9c%ac%e5%88%86%e6%9e%90">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 实验 | 使用本地大模型预测在线评论情感类别 on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fblog%2f2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments%2f&amp;title=%e5%ae%9e%e9%aa%8c%20%7c%20%e4%bd%bf%e7%94%a8%e6%9c%ac%e5%9c%b0%e5%a4%a7%e6%a8%a1%e5%9e%8b%e9%a2%84%e6%b5%8b%e5%9c%a8%e7%ba%bf%e8%af%84%e8%ae%ba%e6%83%85%e6%84%9f%e7%b1%bb%e5%88%ab&amp;summary=%e5%ae%9e%e9%aa%8c%20%7c%20%e4%bd%bf%e7%94%a8%e6%9c%ac%e5%9c%b0%e5%a4%a7%e6%a8%a1%e5%9e%8b%e9%a2%84%e6%b5%8b%e5%9c%a8%e7%ba%bf%e8%af%84%e8%ae%ba%e6%83%85%e6%84%9f%e7%b1%bb%e5%88%ab&amp;source=%2fblog%2f2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 实验 | 使用本地大模型预测在线评论情感类别 on reddit"
        href="https://reddit.com/submit?url=%2fblog%2f2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments%2f&title=%e5%ae%9e%e9%aa%8c%20%7c%20%e4%bd%bf%e7%94%a8%e6%9c%ac%e5%9c%b0%e5%a4%a7%e6%a8%a1%e5%9e%8b%e9%a2%84%e6%b5%8b%e5%9c%a8%e7%ba%bf%e8%af%84%e8%ae%ba%e6%83%85%e6%84%9f%e7%b1%bb%e5%88%ab">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 实验 | 使用本地大模型预测在线评论情感类别 on facebook"
        href="https://facebook.com/sharer/sharer.php?u=%2fblog%2f2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 实验 | 使用本地大模型预测在线评论情感类别 on whatsapp"
        href="https://api.whatsapp.com/send?text=%e5%ae%9e%e9%aa%8c%20%7c%20%e4%bd%bf%e7%94%a8%e6%9c%ac%e5%9c%b0%e5%a4%a7%e6%a8%a1%e5%9e%8b%e9%a2%84%e6%b5%8b%e5%9c%a8%e7%ba%bf%e8%af%84%e8%ae%ba%e6%83%85%e6%84%9f%e7%b1%bb%e5%88%ab%20-%20%2fblog%2f2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 实验 | 使用本地大模型预测在线评论情感类别 on telegram"
        href="https://telegram.me/share/url?text=%e5%ae%9e%e9%aa%8c%20%7c%20%e4%bd%bf%e7%94%a8%e6%9c%ac%e5%9c%b0%e5%a4%a7%e6%a8%a1%e5%9e%8b%e9%a2%84%e6%b5%8b%e5%9c%a8%e7%ba%bf%e8%af%84%e8%ae%ba%e6%83%85%e6%84%9f%e7%b1%bb%e5%88%ab&amp;url=%2fblog%2f2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
    
</div>
<aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
            <summary accesskey="c" title="(Alt + C)">
                <span class="details">Table of Contents</span>
            </summary>

            <div class="inner"><ul>
                    <li>
                        <a href="#%e4%b8%80%e4%bb%bb%e5%8a%a1%e6%8f%8f%e8%bf%b0" aria-label="一、任务描述">一、任务描述</a></li>
                    <li>
                        <a href="#%e4%ba%8c%e4%bc%a0%e7%bb%9f%e6%a8%a1%e5%bc%8f-vs-%e5%a4%a7%e8%af%ad%e8%a8%80%e6%a8%a1%e5%9e%8b" aria-label="二、传统模式 VS 大语言模型">二、传统模式 VS 大语言模型</a></li>
                    <li>
                        <a href="#%e4%b8%89ollama" aria-label="三、Ollama">三、Ollama</a><ul>
                            
                    <li>
                        <a href="#31-%e5%ae%89%e8%a3%85%e6%a8%a1%e5%9e%8b" aria-label="3.1 安装模型">3.1 安装模型</a></li>
                    <li>
                        <a href="#32-%e5%ae%89%e8%a3%85python%e5%8c%85" aria-label="3.2 安装python包">3.2 安装python包</a></li>
                    <li>
                        <a href="#33-%e5%90%af%e5%8a%a8ollama%e6%9c%8d%e5%8a%a1" aria-label="3.3 启动ollama服务">3.3 启动ollama服务</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e5%9b%9b%e5%ae%9e%e9%aa%8c" aria-label="四、实验">四、实验</a><ul>
                            
                    <li>
                        <a href="#41-%e4%bb%a3%e7%a0%81%e7%bb%93%e6%9e%84" aria-label="4.1 代码结构">4.1 代码结构</a></li>
                    <li>
                        <a href="#42-%e8%af%bb%e5%8f%96%e6%95%b0%e6%8d%ae" aria-label="4.2 读取数据">4.2 读取数据</a></li>
                    <li>
                        <a href="#43-%e8%ae%be%e8%ae%a1%e6%8f%90%e7%a4%ba" aria-label="4.3 设计提示">4.3 设计提示</a></li>
                    <li>
                        <a href="#44-%e5%b0%8f%e5%ae%9e%e9%aa%8c" aria-label="4.4 小实验">4.4 小实验</a></li></ul>
                    </li>
                    <li>
                        <a href="#%e4%ba%94-%e6%89%b9%e9%87%8f%e8%bf%90%e7%ae%97" aria-label="五、 批量运算">五、 批量运算</a></li>
                    <li>
                        <a href="#%e5%85%ad%e6%a3%80%e6%9f%a5%e5%87%86%e7%a1%ae%e7%8e%87" aria-label="六、检查准确率">六、检查准确率</a></li>
                    <li>
                        <a href="#%e7%b2%be%e9%80%89%e5%86%85%e5%ae%b9" aria-label="精选内容">精选内容</a>
                    </li>
                </ul>
            </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><p>情感分析是分析文本以确定消息的情绪基调是积极、消极还是中性的过程。通过情感分析，我们可以了解文本是否表现出快乐、悲伤、愤怒等情绪。主要的计算方法有语义词典法、机器学习法、混合方法、其他方法。 随着chatGPT这类大语言模型的出现， 它们增强了文本理解能力，使我们能够更精准的把握文本中的语义和情绪，也因此大型语言模型 (LLM) 一出场就有实现情感分析功能。</p>
<p><img loading="lazy" src="img/Sentiment-Analysis-methods.png" alt=""  />
</p>
<h2 id="一任务描述">一、任务描述<a hidden class="anchor" aria-hidden="true" href="#一任务描述">#</a></h2>
<p>大邓准备了200条外卖评论数据(下图蓝色框)， 已进行标注, 其中负面110条，正面90条。</p>
<p>现在想设计一个Prompt， 使用中文大模型对 <em><strong>review</strong></em> 文本进行情感类别(pos/neg)的预测(红色框)， 最终会计算大模型预测的准确率。</p>
<p><img loading="lazy" src="img/00-purpose.png" alt=""  />
</p>
<p>先提前剧透一下， 模型预测的准确率89.5%。这种准确率，用到经管社科研究中， 应该没啥问题。</p>
<p><br><br></p>
<h2 id="二传统模式-vs-大语言模型">二、传统模式 VS 大语言模型<a hidden class="anchor" aria-hidden="true" href="#二传统模式-vs-大语言模型">#</a></h2>
<p>大语言模型 (LLM) 因其在理解和生成人类语言方面的熟练程度而在情绪分析方面表现出色。通过对各种数据和算法进行训练，LLM 可以检测文本中的细微差别，从而增强其在社交媒体、新闻文章和客户评论等平台上掌握人们情绪和观点的能力。它们捕捉上下文和情感线索的能力提高了情绪分析的准确性和深度。</p>
<p>情感分析领域，传统模式与大语言模型 (LLM) 的比较</p>
<ul>
<li>传统的内容分析方法可能难以准确捕捉细微的情绪。</li>
<li>LLM 使用深度学习和迁移学习等先进技术，擅长理解不同的语言表达。</li>
<li>LLM 在跨文本源（包括社交媒体帖子和新闻文章）的情感分析方面具有卓越的准确性和效率。</li>
</ul>
<p><br><br></p>
<h2 id="三ollama">三、Ollama<a hidden class="anchor" aria-hidden="true" href="#三ollama">#</a></h2>
<p><a href="https://ollama.ai/"><strong>Ollama</strong></a>是一款开源应用程序，可让您使用 MacOS、Linux 和 Windows 上的命令行界面在本地运行、创建和共享大型语言模型。</p>
<p>Ollama 可以直接从其库中访问各种 LLM，只需一个命令即可下载。下载后，只需执行一个命令即可开始使用。这对于工作量围绕终端窗口的用户非常有帮助。Ollama的安装、配置、使用的详细教程可阅读  <a href="https://textdata.cn/blog/2024-06-14-how-to-download-large-language-model-with-ollama/"><strong>教程 | 如何使用 Ollama 下载 &amp; 使用本地大语言模型</strong></a></p>
<br>
<h3 id="31-安装模型">3.1 安装模型<a hidden class="anchor" aria-hidden="true" href="#31-安装模型">#</a></h3>
<p>假设电脑中已安装了Ollama软件， 现在安装需要的大模型。 这里我们安装</p>
<ul>
<li><em><strong>qwen2:7b</strong></em>： 阿里的通义千问大模型， 主要适用于中文场景， 英文也可。</li>
<li><em><strong>llama3:8b</strong></em>：Meta发布的LLama大模型，主要适用于英文场景， 中文也可。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">ollama</span> <span class="n">pull</span> <span class="n">qwen2</span><span class="p">:</span><span class="mi">7</span><span class="n">b</span>
<span class="n">ollama</span> <span class="n">pull</span> <span class="n">llama3</span><span class="p">:</span><span class="mi">8</span><span class="n">b</span>
</code></pre></div><br>
<h3 id="32-安装python包">3.2 安装python包<a hidden class="anchor" aria-hidden="true" href="#32-安装python包">#</a></h3>
<p>打开电脑命令行cmd(mac是terminal),  网络是连网状态，执行安装命令</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">pip3 install ollama
</code></pre></div><br>
<h3 id="33-启动ollama服务">3.3 启动ollama服务<a hidden class="anchor" aria-hidden="true" href="#33-启动ollama服务">#</a></h3>
<p>在电脑中找到软件Ollama， 双击打开，即可开启Ollama服务。</p>
<p><br><br></p>
<h2 id="四实验">四、实验<a hidden class="anchor" aria-hidden="true" href="#四实验">#</a></h2>
<h3 id="41-代码结构">4.1 代码结构<a hidden class="anchor" aria-hidden="true" href="#41-代码结构">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">project
  - code.ipynb  #代码
  - data.csv   #在线评论数据
  - result.csv #预测结果
</code></pre></div><br>
<h3 id="42-读取数据">4.2 读取数据<a hidden class="anchor" aria-hidden="true" href="#42-读取数据">#</a></h3>
<p><em><strong>data.csv</strong></em> 内存储着200条外卖评论，均已标注(1正面， 0负面)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data.csv&#39;</span><span class="p">)</span>
<span class="n">df</span>
</code></pre></div><p><img loading="lazy" src="img/06-df.png" alt=""  />
</p>
<br>
<p>字段的数据类型</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span>
</code></pre></div><p>Run</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">label</span>         <span class="n">int64</span>
<span class="n">review</span>       <span class="nb">object</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</code></pre></div><br>
<p>label数值的分布</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">df</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div><p>Run</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">label
0    110
1     90
Name: count, dtype: int64
</code></pre></div><br>
<h3 id="43-设计提示">4.3 设计提示<a hidden class="anchor" aria-hidden="true" href="#43-设计提示">#</a></h3>
<p>需要根据单词，生成单词、音标、语义、例句、历史文化、相关单词等信息， 提示如下，</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">PROMPT = &#34;&#34;&#34;
您的任务是分析淘宝店铺中买家评论的情感类型(neg、pos)。

&lt;comment_content&gt;
{{COMMENT_CONTENT}}
&lt;/comment_content&gt;

请根据以下准则分析此评论的情感：

&#34;neg&#34;：评论文本中包含强烈的负面情绪、沮丧或不满。

&#34;pos&#34;：评论文本表达了满意、感激或积极情绪


分析后，请以以下 JSON 格式提供最终结果：

&lt;answer&gt;
{
&#34;sentiment&#34;: &#34;[neg/pos]&#34;,
}
&lt;/answer&gt;
&#34;&#34;&#34;
</code></pre></div><br>
<h3 id="44-小实验">4.4 小实验<a hidden class="anchor" aria-hidden="true" href="#44-小实验">#</a></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">time</span>

<span class="kn">import</span> <span class="nn">ollama</span>

<span class="n">COMMENT_CONTENT</span> <span class="o">=</span> <span class="s2">&#34;11点14订餐，13点20饭才到，2个小时才把我的午饭送到，而且还是打了2次客服电话，1次投诉电话才给送来，要是不打电话都不知道几点能吃上午饭？&#34;</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">ollama</span><span class="o">.</span><span class="n">chat</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;qwen2:7b&#39;</span><span class="p">,</span> <span class="n">messages</span><span class="o">=</span><span class="p">[</span>
          <span class="p">{</span><span class="s1">&#39;role&#39;</span><span class="p">:</span> <span class="s1">&#39;system&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">PROMPT</span><span class="p">},</span>
          <span class="p">{</span><span class="s1">&#39;role&#39;</span><span class="p">:</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">COMMENT_CONTENT</span><span class="p">},</span>
        <span class="p">])</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</code></pre></div><p>Run</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">&lt;answer&gt;
{
&#34;sentiment&#34;: &#34;neg&#34;
}
&lt;/answer&gt;
CPU times: user 3.85 ms, sys: 2.5 ms, total: 6.35 ms
Wall time: 1.42 s
</code></pre></div><p>运行一条评论耗时1.42s， 需要注意，返回结果的格式不唯一也不确定，这是我发现的别的格式</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">{
&#34;sentiment&#34;: &#34;neg&#34;
}
CPU times: user 1.94 ms, sys: 1.33 ms, total: 3.27 ms
Wall time: 329 ms
</code></pre></div><br>
<p>据此，设计了如下的代码</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="k">if</span> <span class="s1">&#39;pos&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="n">senti</span> <span class="o">=</span> <span class="s1">&#39;pos&#39;</span>
<span class="k">elif</span> <span class="s1">&#39;neg&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="n">senti</span> <span class="o">=</span> <span class="s1">&#39;neg&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">senti</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
    
<span class="nb">print</span><span class="p">(</span><span class="n">senti</span><span class="p">)</span>
</code></pre></div><p>Run</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">neg
</code></pre></div><br>
<br>
<h2 id="五-批量运算">五、 批量运算<a hidden class="anchor" aria-hidden="true" href="#五-批量运算">#</a></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="o">%%</span><span class="n">time</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">ollama</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="n">PROMPT</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span><span class="s2">您的任务是分析淘宝店铺中买家评论的情绪和类型。您的目标是确定评论情感(neg、pos)。
</span><span class="s2">
</span><span class="s2">&lt;comment_content&gt;
</span><span class="s2">{{COMMENT_CONTENT}}
</span><span class="s2">&lt;/comment_content&gt;
</span><span class="s2">
</span><span class="s2">请根据以下准则分析此评论的情感：
</span><span class="s2">
</span><span class="s2">&#34;neg&#34;：评论文本中包含强烈的负面情绪、沮丧或不满。
</span><span class="s2">
</span><span class="s2">&#34;pos&#34;：评论文本表达了满意、感激或积极情绪
</span><span class="s2">
</span><span class="s2">
</span><span class="s2">分析后，请以以下 JSON 格式提供最终结果：
</span><span class="s2">
</span><span class="s2">&lt;answer&gt;
</span><span class="s2">{
</span><span class="s2">&#34;sentiment&#34;: &#34;[neg/pos]&#34;,
</span><span class="s2">}
</span><span class="s2">&lt;/answer&gt;
</span><span class="s2">&#34;&#34;&#34;</span>


<span class="c1">#考虑到大模型回答的随机性，很容易报错。</span>
<span class="c1">#使用tryexcept增强代码的鲁棒性</span>
<span class="k">def</span> <span class="nf">sentiment_analysis</span><span class="p">(</span><span class="n">comment_text</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">ollama</span><span class="o">.</span><span class="n">chat</span><span class="p">(</span><span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;qwen2:7b&#39;</span><span class="p">,</span> 
                               <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
                                       <span class="p">{</span><span class="s1">&#39;role&#39;</span><span class="p">:</span> <span class="s1">&#39;system&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">PROMPT</span><span class="p">},</span>
                                       <span class="p">{</span><span class="s1">&#39;role&#39;</span><span class="p">:</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">comment_text</span><span class="p">}</span>
                                   <span class="p">])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;pos&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">senti</span> <span class="o">=</span> <span class="s1">&#39;pos&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;neg&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">senti</span> <span class="o">=</span> <span class="s1">&#39;neg&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">senti</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
        <span class="k">return</span> <span class="n">senti</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;NA&#39;</span>

    

<span class="n">sentis</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1">#读取数据</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data.csv&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">review</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;review&#39;</span><span class="p">]):</span>
    <span class="n">senti</span> <span class="o">=</span> <span class="n">sentiment_analysis</span><span class="p">(</span><span class="n">review</span><span class="p">)</span>
    <span class="n">sentis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">senti</span><span class="p">)</span>
    
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;sentiment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sentis</span>
<span class="c1">#保存结果</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;result.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df</span>
</code></pre></div><p><img loading="lazy" src="img/07-df.png" alt=""  />
</p>
<br>
<h2 id="六检查准确率">六、检查准确率<a hidden class="anchor" aria-hidden="true" href="#六检查准确率">#</a></h2>
<p>假设label为1时， sentiment为pos(或label为0时， sentiment为neg)， 大模型判断正确。反之，判断失误。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="n">expression</span> <span class="o">=</span> <span class="s2">&#34;(label == 1) &amp; (sentiment == &#39;pos&#39;) | (label == 0) &amp; (sentiment == &#39;neg&#39;)&#34;</span>
<span class="n">correct_ratio</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">expression</span><span class="p">))</span><span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;准确率: </span><span class="si">{</span><span class="n">correct_ratio</span><span class="o">*</span><span class="mi">100</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
</code></pre></div><p>Run</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">准确率: 89.5%
</code></pre></div><p>今天使用的国产大模型（qwen2:8b) 预测情感分类的表现还不错， 准确率高达89.5% 。这种准确率，用到经管社科研究中， 应该没啥问题。</p>
<br>
<br>
<h2 id="精选内容">精选内容<a hidden class="anchor" aria-hidden="true" href="#精选内容">#</a></h2>
<ul>
<li><a href="https://textdata.cn/blog/datasets_available_for_management_science/">LIST | 可供社科(经管)领域使用的数据集汇总</a></li>
<li><a href="https://textdata.cn/blog/the_text_analysis_list_about_ms/">LIST | 社科(经管)数据挖掘文献资料汇总</a></li>
<li><a href="https://textdata.cn/blog/2024-06-16-scrapegraph-ai/">网络爬虫 | 使用scrapegraph-ai(大模型方案)自动采集网页数据</a></li>
<li><a href="https://textdata.cn/blog/2024-04-27-cntext2x-usage-tutorial/">推荐 | 文本分析库cntext2.x使用手册</a></li>
<li><a href="https://textdata.cn/blog/management_python_course/">付费视频课 | Python实证指标构建与文本分析</a></li>
<li><a href="https://textdata.cn/blog/2024-06-14-using-large-language-model-to-extract-structure-data-from-raw-text/">实验 | 使用本地大模型从文本中提取结构化信息</a></li>
</ul>


  </div>

  <footer class="post-footer">
      <ul class="post-tags">
        <b>Tags:  &nbsp;</b>
        <li><a href="/tags/llm/" target='_blank'>LLM</a></li>
        <li><a href="/tags/%E6%96%87%E6%9C%AC%E5%88%86%E6%9E%90/" target='_blank'>文本分析</a></li>
      </ul>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share 实验 | 使用本地大模型预测在线评论情感类别 on twitter"
        href="https://twitter.com/intent/tweet/?text=%e5%ae%9e%e9%aa%8c%20%7c%20%e4%bd%bf%e7%94%a8%e6%9c%ac%e5%9c%b0%e5%a4%a7%e6%a8%a1%e5%9e%8b%e9%a2%84%e6%b5%8b%e5%9c%a8%e7%ba%bf%e8%af%84%e8%ae%ba%e6%83%85%e6%84%9f%e7%b1%bb%e5%88%ab&amp;url=%2fblog%2f2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments%2f&amp;hashtags=LLM%2c%e6%96%87%e6%9c%ac%e5%88%86%e6%9e%90">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 实验 | 使用本地大模型预测在线评论情感类别 on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fblog%2f2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments%2f&amp;title=%e5%ae%9e%e9%aa%8c%20%7c%20%e4%bd%bf%e7%94%a8%e6%9c%ac%e5%9c%b0%e5%a4%a7%e6%a8%a1%e5%9e%8b%e9%a2%84%e6%b5%8b%e5%9c%a8%e7%ba%bf%e8%af%84%e8%ae%ba%e6%83%85%e6%84%9f%e7%b1%bb%e5%88%ab&amp;summary=%e5%ae%9e%e9%aa%8c%20%7c%20%e4%bd%bf%e7%94%a8%e6%9c%ac%e5%9c%b0%e5%a4%a7%e6%a8%a1%e5%9e%8b%e9%a2%84%e6%b5%8b%e5%9c%a8%e7%ba%bf%e8%af%84%e8%ae%ba%e6%83%85%e6%84%9f%e7%b1%bb%e5%88%ab&amp;source=%2fblog%2f2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 实验 | 使用本地大模型预测在线评论情感类别 on reddit"
        href="https://reddit.com/submit?url=%2fblog%2f2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments%2f&title=%e5%ae%9e%e9%aa%8c%20%7c%20%e4%bd%bf%e7%94%a8%e6%9c%ac%e5%9c%b0%e5%a4%a7%e6%a8%a1%e5%9e%8b%e9%a2%84%e6%b5%8b%e5%9c%a8%e7%ba%bf%e8%af%84%e8%ae%ba%e6%83%85%e6%84%9f%e7%b1%bb%e5%88%ab">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 实验 | 使用本地大模型预测在线评论情感类别 on facebook"
        href="https://facebook.com/sharer/sharer.php?u=%2fblog%2f2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 实验 | 使用本地大模型预测在线评论情感类别 on whatsapp"
        href="https://api.whatsapp.com/send?text=%e5%ae%9e%e9%aa%8c%20%7c%20%e4%bd%bf%e7%94%a8%e6%9c%ac%e5%9c%b0%e5%a4%a7%e6%a8%a1%e5%9e%8b%e9%a2%84%e6%b5%8b%e5%9c%a8%e7%ba%bf%e8%af%84%e8%ae%ba%e6%83%85%e6%84%9f%e7%b1%bb%e5%88%ab%20-%20%2fblog%2f2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share 实验 | 使用本地大模型预测在线评论情感类别 on telegram"
        href="https://telegram.me/share/url?text=%e5%ae%9e%e9%aa%8c%20%7c%20%e4%bd%bf%e7%94%a8%e6%9c%ac%e5%9c%b0%e5%a4%a7%e6%a8%a1%e5%9e%8b%e9%a2%84%e6%b5%8b%e5%9c%a8%e7%ba%bf%e8%af%84%e8%ae%ba%e6%83%85%e6%84%9f%e7%b1%bb%e5%88%ab&amp;url=%2fblog%2f2024-08-06-using-the-ollama-local-large-model-to-predict-the-sentiment-category-of-online-comments%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
    
</div>




  </footer><script src="https://utteranc.es/client.js"
        repo="hiDaDeng/hidadeng.github.io"
        issue-term="pathname"
        theme="preferred-color-scheme"
        crossorigin="anonymous"
        async>
</script>

  
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="/">大邓和他的PYTHON</a></span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'Copy';

        function copyingDone() {
            copybutton.innerText = 'Copied!';
            setTimeout(() => {
                copybutton.innerText = 'Copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>


    
    
</body>

</html>
